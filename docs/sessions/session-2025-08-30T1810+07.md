# Session: 2025-08-30 18:10 +07

- Context: Task 4 — Improve operational resilience with retry/backoff and structured logging for callbacks.
- Changes:
  - PHP verifier: default retries=3 (total 4 attempts) enabling 1s, 2s, 4s backoff with jitter (0–0.5s).
  - Added `retry_backoff` structured log containing `sleep_seconds`, `jitter_seconds`, `next_attempt` for traceability.
  - Preserved idempotency on retries (`X-Idempotency-Key` unchanged; `X-Correlation-ID` propagated).
  - Retries fully gated by `SAN8N_CALLBACK_ASYNC`; filters remain: `san8n_verifier_timeout`, `san8n_verifier_retries`.
  - No workflow JSON bump required — backend contract unchanged.
- Files touched:
  - includes/class-san8n-verifier.php
  - scanandpay-n8n.php (version bump 1.1.4)
  - readme.txt (stable tag + changelog)
  - docs/CHANGELOG.md (entry added)
- Test plan:
  - Simulate 500 on verifier: observe `outbound_response` (status=500), then `retry_backoff` (1s), next attempt, then `retry_backoff` (2s), next attempt, then `retry_backoff` (4s), final attempt, and `retry_fail`.
  - Simulate transient 500 then 200: observe `retry_attempt=1` and `retry_success=1` with final success payload.
- Rollback:
  - Revert includes/class-san8n-verifier.php, scanandpay-n8n.php version lines, readme.txt stable tag and latest changelog entry, and this session log.
